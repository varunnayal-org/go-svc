# migration

## Idea

1. Add files in `src/entity` directory
2. Update [migration-loader/main.go](./migration-loader/main.go) and add the entity/enum.

3. Run `atlas migrate diff --env gorm`. This will result in a new file getting generated in `migrations/atlas-dir` directory(specified in [atlas.hcl](./atlas.hcl)).

```sh
tree migrations
migrations
├── 20230921084606.sql # generated by adding changes in loader/main.go file
└── atlas.sum # checksum file
```

Add a new entity

```sh
cat >> src/entity/category.go << EOL
package enum

// Category should map to category_type_enum
type Category string

const (
  Cat1 Category = "one"
  Cat2 Category = "two"
)

// AllCategories returns all possible values for Category
func (c Category) All() []string {
  return []string{
    string(Cat1),
    string(Cat2),
  }
}

// Name returns the name of the enum
func (c Category) Name() string {
  return "category_name_enum"
}

EOL
```

Follow step 2 to 4 from above.

## Schema addition

### Enum

Enums should implement following interface

```go
type IEnum interface {
  // Name of the enum
  Name() string
  // List of all the enums as a string
  All() []string
}
```
